# micro:bit Music Player - 構想ドキュメント

## プロジェクト概要

micro:bit単体で動作する多機能音楽プレーヤーの開発。複数の楽曲を管理し、リアルタイムでキー変更（移調）が可能な、インタラクティブな音楽再生システム。

## 開発動機

- micro:bitの音楽機能を最大限活用したい
- ゲーム音楽（RPG序曲など）を手軽に演奏したい
- ハードウェア制約の中で豊かな音楽体験を提供したい
- 教育現場で音楽とプログラミングの融合を示したい

## コア機能

### 1. 複数曲管理
- 辞書形式でのデータ構造
- 曲の追加が容易
- メモリ効率の良い設計

### 2. インタラクティブな操作
- ボタンによる直感的な操作
- 長押し/短押しの使い分け
- 演奏中の操作受付

### 3. リアルタイム移調
- 半音単位でのキー変更
- オクターブを跨ぐ自動調整
- 曲切り替え時の自動リセット

### 4. 視覚的フィードバック
- LED表示による音高の可視化
- バー表示での直感的な表現
- 操作フィードバックの表示

## ターゲット楽曲

### Phase 1（実装済み）
- ドラゴンクエスト序曲
  - ファンファーレ部分
  - メインテーマ
- ファイナルファンタジー序曲
  - アルペジオ風アレンジ

### Phase 2（将来の拡張）
- ドラクエ戦闘曲
- FFビクトリーファンファーレ
- オリジナル楽曲
- ユーザー定義曲

## 技術的制約と課題

### ハードウェア制約
- メモリ: 限られたRAM容量
- 処理能力: リアルタイム処理の制限
- 入力: 2つのボタンのみ
- 出力: 5×5 LEDマトリクス、単音スピーカー

### 対応策
- 効率的なデータ構造（辞書＋リスト）
- シンプルな音階計算アルゴリズム
- 長押し/短押しによる操作の多重化
- バー表示による情報の圧縮

## ユーザー体験の設計

### 操作フロー
```
起動
 ↓
Ready表示
 ↓
曲を自動再生（ループ）
 ↓
ボタン操作
 ├─ A長押し → 前の曲
 ├─ B長押し → 次の曲
 ├─ A短押し → キー下げ
 ├─ B短押し → キー上げ
 └─ A+B    → キーリセット
```

### フィードバック設計
1. 曲切り替え時: 曲名をスクロール表示
2. キー変更時: 現在のシフト量を表示
3. 演奏中: 音高をLEDバーで表示
4. キーリセット時: "Key Reset"と表示

## 拡張性の確保

### 容易な拡張ポイント
1. **曲の追加**: `songs`辞書に追加するだけ
2. **LED演出**: `display_pitch()`関数の変更
3. **テンポ調整**: 新しいグローバル変数とボタン操作の追加
4. **再生モード**: ループ/ワンショット切り替え

### データフォーマット
```python
'音名+オクターブ:長さ'
例: 'C5:4' → C5の音を4単位の長さで
```

- 音名: C, C#, D, D#, E, F, F#, G, G#, A, A#, B
- オクターブ: 3～8
- 長さ: 1～8（数値が大きいほど長い）

## 教育的価値

### 学習要素
1. **プログラミング概念**
   - リスト・辞書のデータ構造
   - 関数の定義と呼び出し
   - グローバル変数の管理
   - 条件分岐とループ

2. **音楽理論**
   - 音階の構造（12音階）
   - オクターブの概念
   - 移調（キー変更）の仕組み

3. **ハードウェア制御**
   - ボタン入力の処理
   - LED制御
   - 音声出力

4. **UX設計**
   - 限られた入力での操作設計
   - フィードバックの重要性
   - 直感的なインターフェース

## 成功指標

- [ ] 安定した音楽再生
- [ ] 直感的な操作性
- [ ] スムーズな曲切り替え
- [ ] 正確な移調機能
- [ ] 見やすいLED表示
- [ ] 簡単な曲追加プロセス
